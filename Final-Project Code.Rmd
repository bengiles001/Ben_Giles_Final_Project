---
title: "Final Project Code"
author: "Ben Giles"
date: "12/9/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(rvest)
library(dplyr)
library(tidyverse)
library(party)
```
### Guiding Question:
What relationships are there between Role and statistics in the NBA? 


```{r}
url1 <- "https://www.basketball-reference.com/pi/shareit/vYOnK"

NBAraw1 <- url1 %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)


url2 <- "https://www.basketball-reference.com/pi/shareit/pJVmT"

NBAraw2 <- url2 %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)


```
```{r}
NBAdf1 <- NBAraw1[[1]]
is.data.frame(NBAdf1)

NBAdf1join <-
  NBAdf1 %>%
  filter(Rk != "Rk")

NBAdf2 <- 
  NBAraw2[[1]]
NBAdf2
colnames(NBAdf2)[3] <- "TS"
colnames(NBAdf1)[10] <- "FGpct"
colnames(NBAdf1)[12] <- "ThreePtAtt"
colnames(NBAdf1)[13] <- "ThreePtpct"
colnames(NBAdf1)[15] <- "TwoPA"
colnames(NBAdf1)[16] <- "TwoPpct"
colnames(NBAdf1)[17] <- "eFGpct"
NBAdf1join <-
  NBAdf1 %>%
  filter(Rk != "Rk")

is.data.frame(NBAdf2)

#Jointbl <- NBAdf2[ -c(1,3:8,10:29) ]
NBAFullStatNoFilter <-
  NBAdf1 %>%
    mutate(G = as.numeric(G),
         FG = as.numeric(FG),
         eFGpct = as.numeric(eFGpct),
         PTS = as.numeric(PTS),
         AST = as.numeric(AST),
         TRB = as.numeric(TRB),
         BLK = as.numeric(BLK),
         ThreePtpct = as.numeric(ThreePtpct),
         TwoPpct = as.numeric(TwoPpct),
         TwoPA = as.numeric(TwoPA))
NBAFullstat <-

  inner_join(NBAdf1join,NBAdf2,by="Player") %>%
  
  mutate(G = as.numeric(G),
         FG = as.numeric(FG),
         eFGpct = as.numeric(eFGpct),
         PTS = as.numeric(PTS),
         AST = as.numeric(AST),
         TRB = as.numeric(TRB),
         BLK = as.numeric(BLK),
         ThreePtpct = as.numeric(ThreePtpct),
         ThreePtAtt = as.numeric(ThreePtAtt),
         TwoPpct = as.numeric(TwoPpct),
         TwoPA = as.numeric(TwoPA),
         TS = as.numeric(TS)
         
         ) %>%
  
  filter(!grepl("-", Pos)) %>% #took out the 5 players who are listed at 2 positions becuase they would 
  filter(G >= 51) 


RelevantStats <-
  NBAFullstat %>%
  select(Pos, PTS, AST, TRB, BLK, ThreePtpct, TwoPpct, TS)
RelevantStats <- tibble::rowid_to_column(RelevantStats, "ID")

RelevantStats



```

```{r}
PositionTable <-
  RelevantStats%>%
  group_by(Pos) %>%
  summarise_at(c(2:8), mean, na.rm = TRUE) %>%
  arrange(desc(PTS))
PositionTable
```
```{r}
#function for median data in league

PositionTable %>%
  ggplot(aes(x = Pos, y = PTS)) +
  geom_bar(stat = "identity")

NBAFullstat %>% 
  select(Player, Pos, AST) %>%
  filter(rank(desc(AST)) <= 11)  %>%
  arrange(desc(AST))
NBAFullstat %>%
  select(Player, Pos, TRB) %>%
  filter(rank(desc(TRB)) <= 11) 
```
## Finding stats that stand out 

After looking at positional averages I soloed out some of the more extreme differences that were found. The two biggest were Assists(AST) and Rebounds(TRB).

```{R}
NBAFullstat %>%
  ggplot(aes(y = TRB, x = Pos)) + 
  geom_boxplot(aes(color = Pos, fill = Pos), 
               alpha = 0.25, outlier.size = 2, outlier.colour = "gray") + 
  xlab("Position") + 
  ylab("TRB Per Game") + 
  theme(legend.position = "top") +  
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
```
```{R}
NBAFullstat %>%
  ggplot(aes(y = AST, x = Pos)) + 
  geom_boxplot(aes(color = Pos, fill = Pos), 
               alpha = 0.25, outlier.size = 2, outlier.colour = "gray") + 
  xlab("Position") + 
  ylab("Assists Per Game") + 
  theme(legend.position = "top") +  
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
```
```{r}
NBAFullstat %>%
  ggplot(aes(y = PTS, x = Pos)) + 
  geom_boxplot(aes(color = Pos, fill = Pos), 
               alpha = 0.25, outlier.size = 2, outlier.colour = "gray") + 
  xlab("Position") + 
  ylab("PTS Per Game") + 
  theme(legend.position = "top") +  
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

```
## Finding shooting trends


```{r}
NBAFullstat %>%
  ggplot(aes(x=TS, y=ThreePtAtt)) +
  geom_line(size=2, aes(color=Pos)) +
  facet_wrap(~ Pos) +
  theme_bw() +
  stat_smooth()#theme_gray, theme_linedraw, theme_classic, and so on. 
```
```{r}
NBAFullstat %>%
  ggplot(aes(x=ThreePtpct, y=TS)) +
  geom_line(size=2, aes(color=Pos)) +
  facet_wrap(~ Pos) +
  geom_smooth() +
  theme_bw() #theme_gray, theme_linedraw, theme_classic, and so on. 
```
```{r}
PositionTable %>%
  ggplot(aes(x = Pos, y = TRB)) +
  geom_bar(stat = "identity")

NBAFullstat %>%
  ggplot(aes( x = TwoPpct)) +
  geom_histogram() +
  facet_wrap( ~ Pos)
NBAFullstat %>%
  ggplot(aes( x = ThreePtpct)) +
  geom_histogram() +
  facet_wrap( ~ Pos)
NBAFullstat %>%
  ggplot( aes(x = ThreePtpct) ) + 
  geom_density(aes(color = Pos, fill = Pos), alpha = 0.75, adjust = 2) + 
  facet_wrap( ~ Pos, nrow = 1 ) +
  xlab("ThreePtpct") + 
  ylab( "Count") + 
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

```


```{r}
NBAFullstat %>%
  ggplot(aes( y = TS , x = PTS)) +
  stat_smooth() +
  facet_wrap(~ Pos)
```
##Using what I have learned. 

What I have learned so far is that there are two roles in the nba that are most distiguishable purely by stats and that would be PG and C. Both of these roles have unique statistical metrics in lows and highs throughout the board. From looking at my data above I chose variables to use in decicion trees that would distinguish whether a player was one of these two positions. Point Guards(PG) have very high average Assists per game, the highest PTS per game and the lowest TRB per game. Where as Centers(C) have the lowest AST per game but a very high avg true shoting percentage(TS) and Total Rebounds(TRB) per game.
```{r}
Whoispointguard <-
  party::ctree(Pos == "PG" ~AST + PTS + TRB, data=NBAFullstat)
plot(Whoispointguard, type="simple")
```
```{r}
Whoispointguard <-
  party::ctree(Pos == "C" ~TS + TRB + AST, data=NBAFullstat)
plot(Whoispointguard, type="simple")
```