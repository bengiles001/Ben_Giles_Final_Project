---
title: "Final Project Code"
author: "Ben Giles"
date: "12/9/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(rvest)
library(dplyr)
library(tidyverse)
```
```{r}
ThreeyearStats <- read.csv("threeyrnbastats.csv",
           header = TRUE,
           sep = ",",
           stringsAsFactors = FALSE)
ThreeyearStats
```

```{r}
url1 <- "https://www.basketball-reference.com/pi/shareit/vYOnK"

NBAraw1 <- url1 %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)
str(NBAraw1)

url2 <- "https://www.basketball-reference.com/pi/shareit/pJVmT"

NBAraw2 <- url2 %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)
str(NBAraw2)

```
```{r}
NBAdf1 <- NBAraw1[[1]]
is.data.frame(NBAdf1)

NBAdf1join <-
  NBAdf1 %>%
  filter(Rk != "Rk")
NBAdf1
NBAdf2 <- 
  NBAraw2[[1]]
colnames(NBAdf2)[3] <- "TSpct"
colnames(NBAdf1)[10] <- "FGpct"
colnames(NBAdf1)[12] <- "ThreePtAtt"
colnames(NBAdf1)[13] <- "ThreePtpct"
colnames(NBAdf1)[15] <- "TwoPA"
colnames(NBAdf1)[16] <- "TwoPpct"
colnames(NBAdf1)[17] <- "eFGpct"
NBAdf1join <-
  NBAdf1 %>%
  filter(Rk != "Rk")
NBAdf1
is.data.frame(NBAdf2)

#Jointbl <- NBAdf2[ -c(1,3:8,10:29) ]
NBAFullStatNoFilter <-
  NBAdf1 %>%
    mutate(G = as.numeric(G),
         FG = as.numeric(FG),
         eFGpct = as.numeric(eFGpct),
         PTS = as.numeric(PTS),
         AST = as.numeric(AST),
         TRB = as.numeric(TRB),
         BLK = as.numeric(BLK),
         ThreePtpct = as.numeric(ThreePtpct),
         TwoPpct = as.numeric(TwoPpct),
         TwoPA = as.numeric(TwoPA))
NBAFullstat <-

  inner_join(NBAdf1join,NBAdf2,by="Player") %>%
  
  mutate(G = as.numeric(G),
         FG = as.numeric(FG),
         eFGpct = as.numeric(eFGpct),
         PTS = as.numeric(PTS),
         AST = as.numeric(AST),
         TRB = as.numeric(TRB),
         BLK = as.numeric(BLK),
         ThreePtpct = as.numeric(ThreePtpct),
         TwoPpct = as.numeric(TwoPpct),
         TwoPA = as.numeric(TwoPA)
         
         ) %>%
  filter(G >= 58) 
colnames(NBAFullstat)[31] <- "TS"
NBAFullstat

#NBABasketballPerGame <- 
  #cbind(NBAbballraw[[1]], NBAbballraw[[2]]) %>%
  #(Name != "Total")
#NBABasketballPerGame


```

```{r}
Positionpts <-
  NBAFullstat %>%
  group_by(Pos) %>%
  summarise(avgPTS = mean(PTS)) %>%
  arrange(desc(avgPTS))
Positionast <-
  NBAFullstat %>%
  group_by(Pos) %>%
  summarise(avgAST = mean(AST)) %>%
  arrange(desc(avgAST))
PositionTRB <-
  NBAFullstat %>%
  group_by(Pos) %>%
  summarise(avgTRB = mean(TRB)) %>%
  arrange(desc(avgTRB))
PositionBLK <-
  NBAFullstat %>%
  group_by(Pos) %>%
  summarise(avgBLK = mean(BLK)) %>%
  arrange(desc(avgBLK))
Position3Ppct <-
  NBAFullstat %>%
  group_by(Pos) %>%
  summarise(avgThreePpct = mean(ThreePtpct)) %>%
  arrange(desc(avgThreePpct))
PositionTwoPpct <-
  NBAFullstat %>%
  group_by(Pos) %>%
  summarise(avgTwoPpct = mean(TwoPpct)) %>%
  arrange(desc(avgTwoPpct))
PositionTwoPpct
PositionTable <-
  left_join(Positionpts, Positionast) %>%
  left_join(., PositionTRB) %>%
  left_join(., PositionBLK) %>%
  left_join(., Position3Ppct) %>%
  left_join(., PositionTwoPpct)
PositionTable

NBAFullstat %>%
  ggplot(aes(x=eFGpct, y=ThreePtpct)) +
  geom_point(size=2, aes(color=Pos)) +
  geom_smooth() +
  theme_bw() #theme_gray, theme_linedraw, theme_classic, and so on. 
```
```{r}
Positionpts %>%
  ggplot(aes(x = Pos, y = avgPTS)) +
  geom_bar(stat = "identity")

NBAFullstat %>%
  ggplot(aes( x = TwoPpct)) +
  geom_histogram() +
  facet_wrap( ~ Pos)
Questiontable <-
  NBAFullstat %>%
  filter(Pos == "SF-SG")
Questiontable
```

```{r}
#function for median data in league
TEAMstatstbl <-
  NBAFullStatNoFilter%>%
  group_by(Tm) %>%
  filter(Tm != "TOT") %>%
  filter(Tm != "Tm") %>%
  summarise(total = sum(PTS)) %>%
  spread(key = Tm, value = total, fill = 0)
TEAMstatstbl


```
